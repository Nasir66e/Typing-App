<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master</title>
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
body {
  /*overflow: hidden;*/
  user-select: none;
  margin-top: none;
  background: #c3cdff;
  color: #000000;
}

#mainpg {
  height: 100%;
  width: 100%;
  background: transparent;
  padding: 0px;
  border-radius: 10px;
}

#panel {
  height: 560px;
  width: 650px;
  background: #efffd7;
  border: 6px solid #6a55d1;
  border-radius: 25px;
  display: grid;
  grid-template-columns: 2.7fr 1fr;
  grid-template-rows: 1fr;
  grid-column-gap: 0px;
}

#timermenu {
  grid-area: 1 / 2 / 3 / 3;
  background: #d1f59e;
  border-top-right-radius: 20px;
  border-bottom-right-radius: 20px;
  display: grid;
  grid-template-columns: 1.2fr;
  grid-template-rows: 1fr 0.5fr 2fr 5fr 1.2fr 0.8fr;
  grid-column-gap: 0px;
  grid-row-gap: 2px;
}

.spc {
  grid-area: 4 / 1 / 5 / 2;
  background: transparent;
}

#nxt {
  grid-area: 5 / 1 / 6 / 2;
  background: transparent;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}

#nxtbtn {
  font-size: 14px;
  height: 58%;
  width: 86%;
  background: linear-gradient(0deg, rgba(212, 215, 245, 1) 0%, rgba(255, 255, 255, 1) 100%);
  border-radius: 6px;
  box-shadow: none;
  outline: none;
  color: #000683;
  border: 1px solid #8f95bf;
}

#cls {
  grid-area: 6 / 1 / 7 / 2;
  background: transparent;
  border-bottom-right-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#clsbtn {
  height: 60%;
  width: 86%;
  font-size: 14px;
  background: #efffd7;
  border-radius: 6px;
  box-shadow: none;
  outline: none;
  color: #000683;
  border: 1px solid #8f95bf;
}
    
*::selection {
  background: transparent;
}
        
#result_pnl {
            text-align: left;
            
            font-family: Calibri;
            background: linear-gradient(180deg, #def8b6, #f0ffd8, #f0fdde, #f0fdde, #f0fdde, #f0fdde, #f0fdde, #f0fdde, #f0fdde);
            border-top-left-radius: 25px;
            border-bottom-left-radius: 25px;
        }
        #result_pnl h1:first-of-type {
            font-weight: 500;
            letter-spacing: 1px;
            color: #60763f;
            margin-top: 6px;
            padding-left: 16px;
        }
        #result_pnl #result {
            width: 80%;
            margin: 0 auto;
        }
        #result_pnl p:first-of-type span {
            font-size: 18px;
        }
        #result_pnl p:first-of-type {
            margin-bottom: 30px;
        }
        #result_pnl #table {
            width: 100%;
            border-top: 1px solid #c9e2a6;
            border-bottom: 1px solid #c9e2a6;
        }
        #table {
            padding: 16px 0 16px 0;
        }
        #table td {
            width: 136px;
        }
        #table + h3 {
            font-size: 18px;
        }
        #diff-keys {
            height: 110px;
            width: 90%;
            background: #e6fdc5;
            border: 1px solid #60763f;
            border-radius: 1px;
        }
        #diff-keys div {
            text-align: right;
            height: calc(100% / 3);
            width: 100%;
            background: transparent;
        }
        #diff-keys p {
            margin: 0 5px 0 0; 
            color: #60763f;
            line-height: 2;
        }
        #result-btn {
            height: 70px;
            width: 100%;
            background: transparent;
            display: flex;
            justify-content: flex-start;
            flex-direction: column;
            border-top: 1px solid #c9e2a6;
            padding-top: 6px;
        }
        #result-btn button {
            padding: 5px;
            width: 56%;
            border-radius: 5px;
            border: 1px solid #60763f;
            text-align: left;
            margin-top: 6px;
            margin-bottom: 2px;
            background: linear-gradient(0deg, #e9fdc8, #f2fee1, #f2fee1);
            color: #28301f;
        }
        #keys {
            height: 12px;
            width: 90%;
            background: transparent;
            margin-top: -2px;
            padding: 0 0 0 15px;
        }
        #keys td {
            border-left: 1px solid #60763f;
            width: 26px;
            height: 2px;
            background: transparent;
        }
        #keys td:last-of-type {
            border-right: 1px solid #60763f;
        }
        #letter {
            height: auto;
            width: 90%;
            background: transparent;
            margin-top: 2px;
            margin-bottom: 20px;
            padding: 0 0 0 11px;
        }
        #letter td {
            width: 26px;
            height: auto;
            background: transparent;
            padding: none;
            border-left: 1px solid transparent;
            font-size: 12px;
            line-height: .1;
            text-align: left;
            color: #28301f;
        }
        #diffKeysChart {
            background: transparent;
            border: none;
            outline: none;
            width: 280px;
            height: 90px;
            margin-top: -141px;
        }
        
    </style>
  </head>
  <body>
      
 <div id="mainpg">
  <center>
    <div id="panel">
        <div id="result_pnl">
    <h1 id="page_title">Typing Test Results</h1>
        <div id="result">
        <p><span id="msg-head"><b>Test Interrupted</b></span>
        <br>
        <!--Test Passed-->
        <span id="message">The test was interrupted before the time was up.</span>
        </p>
        <!--You completed this typing test.-->
        <div id="table">
        <table>
            <tr>
                <td><b>Time Used</b></td>
                <td id="time-used">2:00min.</td>
            </tr>
            <tr>
                <td><b>Groos Speed</b></td>
                <td id="gross-speed">0 wpm</td>
            </tr>
            <tr>
                <td><b>Accuracy</b></td>
                <td id="accuracy">0%</td>
            </tr>
            <tr>
                <td><b>Net Speed</b></td>
                <td id="net-speed">0 wpm</td>
            </tr>
        </table>
            </div>
            <h3>Your Difficult Keys</h3>
            <div id="diff-keys">
            <div style="border-bottom:1px solid #a2bb7c"><p>Problematic</p></div>
            <div style="border-bottom:1px solid #a2bb7c"><p>Difficult</p></div>
            <div><p>OK</p></div>
            </div>
            <canvas id="diffKeysChart"></canvas>
            <div id="keys">
            <table>
                <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                </tr>
                </table>
            </div>
            <div id="letter">
            <table>
                <tr>
                <td id="key-1" class="key"></td>
                <td id="key-2" class="key"></td>
                <td id="key-3" class="key"></td>
                <td id="key-4" class="key"></td>
                <td id="key-5" class="key"></td>
                <td id="key-6" class="key"></td>
                <td id="key-7" class="key"></td>
                <td id="key-8" class="key"></td>
                <td id="key-9" class="key"></td>
                <td id="key-10" class="key"></td>
                </tr>
                </table>
            </div>
            <div id="result-btn">
            <button type="button">► View and Print Result</button>
            <button type="button">► View and Print Certificate</button>
            </div>
        </div>
            </div>
      <div id="timermenu">
        
        <div class="spc"> </div>
        <div id="nxt"><button type="button" id="nxtbtn" class="nxtbtn_" onclick="go('content_page.html')"><span style="text-decoration:underline">N</span>ext</button></div>
        <div id="cls"><button type="button" id="clsbtn" class="clsbtn_" onclick="go('index.html')"><span style="text-decoration:underline">C</span>ancel</button> </div>
      </div>
    </div>
  </center>
</div>     
      <script>

let msg_head_elem = document.getElementById('msg-head');
let message_elem = document.getElementById('message');
let time_used_elem = document.getElementById('time-used');
let gross_speed_elem = document.getElementById('gross-speed');
let accuracy_elem = document.getElementById('accuracy');
let net_speed_elem = document.getElementById('net-speed');

let message;
let time_used;
let gross_speed;
let accuracy;
let net_speed;
let diff_keys;
let frequencies;

function get_results() {
  message = localStorage.getItem('message');
  time_used = localStorage.getItem('time-used');
  gross_speed = localStorage.getItem('gross-speed');
  accuracy = localStorage.getItem('accuracy');
  net_speed = localStorage.getItem('net-speed');
  diff_keys = localStorage.getItem('diffKeys');
  diff_keys = diff_keys.split(',');
  frequencies = localStorage.getItem('frequencies');
  frequencies = frequencies.split(',');
  frequencies = frequencies.map(function(item) { return parseInt(item); });
  frequencies = frequencies.map(function(item) { return item > 12 ? 12 : item; });

  if (diff_keys.length > 0 && diff_keys.length > 8) {
    diff_keys = diff_keys.slice(0, 8);
  }

  if (frequencies.length > 0 && frequencies.length > diff_keys.length) {
    frequencies = frequencies.slice(0, diff_keys.length - 1);
  }

  if (frequencies.length < 12) {
    frequencies = frequencies.map(function(item) { return frequencies.length < 12 ? frequencies.push(0) : false; });
  }

  create_chart();
  set_results();
}

function go(url) {
    window.location.href = url;
}

window.onload = function() {

  get_results();

};

function create_chart() {

    // Get the canvas context for the chart
    var ctx = document.getElementById('diffKeysChart').getContext('2d');

    // Assign bars color based on frequency
    var barColor = frequencies.map(function(freq) {
        if (freq > 8) {
            return 'rgb(255 0 78)'; // Frequency greater than 8
        } else if (freq > 4) {
            return 'rgb(255 210 17)'; // Frequency greater than 4
        } else {
            return 'rgb(168 181 247)'; // Default color for others
        }
    });

    // Create the bar chart
    var diffKeysChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: diff_keys, // The keys as labels for the X-axis
            datasets: [{
                data: frequencies, // The corresponding difficulty counts for the keys
                backgroundColor: barColor, // Semi-transparent bars
                borderColor: 'rgb(63 63 63)', // Bar border color
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: false // Disable the legend
                }
            },
            scales: {
                x: {
                    display: false, // Hide the X-axis
                    beginAtZero: true,
                    // Adjust spacing between bars
                    barPercentage: 1,  // Width of bars (default is 0.9)
                    categoryPercentage: 0.5 // Width of the bar category (default is 0.8)
                },
                y: {
                    display: false, // Hide the Y-axis
                    beginAtZero: true,
                    suggestedMax: 15 // Set maximum Y-axis value to control bar height
                }
            },
            responsive: false, // Disable responsiveness to control size manually
            maintainAspectRatio: true, // Maintain aspect ratio
            layout: {
                padding: 0 // Remove any padding
            }
        }
    });
}

function set_results() {

  let minutes = Math.floor(time_used / 60);
  let seconds = time_used % 60;

  time_used_elem.innerText = minutes + ":" + (seconds < 10 ? "0" : "") + seconds + ' min.';
  gross_speed_elem.innerText = gross_speed + ' wpm';
  accuracy_elem.innerText = accuracy + '%';
  net_speed_elem.innerText = net_speed + ' wpm';

  for (let i=0; i<8; i++) {
    if (diff_keys[i] !== undefined) {
      document.getElementById(`key-${i+1}`).innerText = diff_keys[i];
    }
  }

}          
      
      </script>
  </body>
</html>
