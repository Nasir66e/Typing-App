<!DOCTYPE html>
<html>
  <head>
    <title>Hello, World!</title>
    <style>
body {
  overflow: hidden;
  user-select: none;
  margin-top: none;
  background: #c3cdff;
  color: #000000;
}

#mainpg {
  height: 100%;
  width: 100%;
  background: transparent;
  padding: 0px;
  border-radius: 10px;
}

#panel {
  height: 560px;
  width: 650px;
  background: #efffd7;
  border: 6px solid #6a55d1;
  border-radius: 25px;
  display: grid;
  grid-template-columns: 2.7fr 1fr;
  grid-template-rows: repeat(2, 1fr);
  grid-column-gap: 0px;
  grid-row-gap: 5px;
}

#contentbox {
  height: 250px;
  grid-area: 1 / 1 / 2 / 2;
  background: #efffd7;
  border: 1px solid transparent;
  border-top-left-radius: 20px;
  padding: 22px 22px 3px 22px;
  font-size: 20px;
  color: #000;
  text-align: left;
  overflow-y: scroll;
}
    
#contentbox::-webkit-scrollbar {
    width: 0px;
}

#typingbox {
  height: 250px;
  grid-area: 2 / 1 / 3 / 2;
  background: #efffd7;
  border: 1px solid #c9e99b;
  border-bottom-left-radius: 20px;
  border-width: 1px 0px 0px 0px;
  padding: 10px 22px 15px 22px;
  user-select: none;
}

#timermenu {
  grid-area: 1 / 2 / 3 / 3;
  background: #d1f59e;
  border-top-right-radius: 20px;
  border-bottom-right-radius: 20px;
  display: grid;
  grid-template-columns: 1.2fr;
  grid-template-rows: 1fr 0.5fr 2fr 5fr 1.2fr 0.8fr;
  grid-column-gap: 0px;
  grid-row-gap: 2px;
}

.tmtitle {
  grid-area: 1 / 1 / 2 / 2;
  background: transparent;
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  padding: 5px;
  font-size: 17px;
  font-weight: bold;
  border-top-right-radius: 20px;
}
        
.tmtitle button {
  height: 20px;
  width: 20px;
  background: #a9de62;
  border: 1px solid #878993;
  border-radius: 2px;
  box-shadow: 0px 2px #c7e47f inset;
  padding: 0 0 0 0;
  margin-left: 140px;
  margin-top: 3px;
  margin-bottom: 20px;
    color: #fff;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
        }
.tmtitle span {
    font-family: Arial;
    padding-left: 6px;
        }
.tmtitle line {
  height: auto;
  width: 90%;
  border-top: 1px solid #fff;
  margin-top: 2px;
        }

.timebox {
  grid-area: 2 / 1 / 3 / 2;
  background: transparent;
}
#timeClock p {
    font-weight: bolder;
    font-family: Arial;
    font-size: 26px;
    line-height: 1;
    background: transparent;
    margin-top: -2px;
    text-align: left;
    padding-left: 12px;
        }
#timer {
    margin-top: -26px;
        }
.tmgif {
  grid-area: 3 / 1 / 4 / 2;
  background: transparent;
}

.spc {
  grid-area: 4 / 1 / 5 / 2;
  background: transparent;
}

#nxt {
  grid-area: 5 / 1 / 6 / 2;
  background: transparent;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}

#nxtbtn {
  font-size: 14px;
  height: 58%;
  width: 86%;
  background: linear-gradient(0deg, rgba(212, 215, 245, 1) 0%, rgba(255, 255, 255, 1) 100%);
  border-radius: 6px;
  box-shadow: none;
  outline: none;
  color: #000683;
  border: 1px solid #8f95bf;
}

#cls {
  grid-area: 6 / 1 / 7 / 2;
  background: transparent;
  border-bottom-right-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#clsbtn {
  height: 60%;
  width: 86%;
  font-size: 14px;
  background: #efffd7;
  border-radius: 6px;
  box-shadow: none;
  outline: none;
  color: #000683;
  border: 1px solid #8f95bf;
}

#txtera {
  height: 100%;
  width: 100%;
  color: #546e30;
  background: transparent;
  font-size: 20px;
  font-family: initial;
  border-bottom-left-radius: 10px;
  padding: 2px;
  border: none;
  outline: none;
  caret-color: #000;
  user-select: none;
  overflow-y: scroll;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  text-align: left;
}

#txtera::-webkit-scrollbar {
    width: 0px;
}
    
*::selection {
  background: transparent;
}

#txtera:active {
  outline: none;
  border: none;
}

#contentbox span {
        background: transparent;
    }
    </style>
  </head>
<body>
    <div id="mainpg">
        <center>
            <div id="panel">
                <div id="contentbox"></div>
                <div id="typingbox">
                    <div id="txtera"></div>
                </div>
                <div id="timermenu">
                    <div class="tmtitle">
                        <button type="button" id="closeBtn">&times;</button>
                        <span>Time</span>
                        <line></line>
                    </div>
                    <div class="timebox">
                        <div id="timeClock"><p>00:00</p></div>
                        <img id="timer" src="timer.png" alt="Timer <" height="90" width="176"/>
                    </div>
                    <div class="tmgif"></div>
                    <div class="spc"></div>
                    <div id="nxt">
                        <button type="button" id="nxtBtn"><span style="text-decoration:underline">N</span>ext</button>
                    </div>
                    <div id="cls">
                        <button type="button" id="clsBtn"><span style="text-decoration:underline">C</span>Cancel</button>
                    </div>
                </div>
            </div>
        </center>
    </div>

    <script>
        (function() {
            const alphabets = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890~!@#$%^&*()_+-=/.,|[]}\'"';
            const url = "content.json";
            let started = false;
            let timeLeft = 120;
            let timeElapsed = 0;
            let errors = 0;
            let lastword = "";
            let backspaces = 0;
            let spaces = 0;
            let contcrrwno = 0;
            let contcrrchno = 0;
            let allinptxtlen = 0;
            let allinptxt = "";
            let inpwarr = [];
            let content_array = [];
            let inpcharr = allinptxt.split("");
            let correctWords = 0;
            let wrongWords = 0;
            let totalWordsTyped = 0;
            let totalStrokes = 0;
            let currentWord = contcrrwno + 1;
            let timer = null;
            let result = null;
            let gmOver = false;

            const inptxtpnl = document.getElementById("txtera");
            const contpnl = document.getElementById("contentbox");
            const timerImg = document.getElementById('timer');
            const closeBtn = document.getElementById('closeBtn');
            const nxtBtn = document.getElementById('nxtBtn');
            const clsBtn = document.getElementById('clsBtn');

            document.addEventListener("contextmenu", (event) => event.preventDefault());
            document.addEventListener("copy", (event) => event.preventDefault());
            document.addEventListener("paste", (event) => event.preventDefault());
            inptxtpnl.addEventListener("dragstart", (event) => event.preventDefault());
            inptxtpnl.addEventListener("select", (event) => event.preventDefault());

            closeBtn.addEventListener("click", () => window.close());
            nxtBtn.addEventListener("click", gameOver);
            clsBtn.addEventListener("click", () => window.history.back());

            async function fetchData() {
                try {
                    const response = await fetch(url);
                    const result = await response.json();
                    const text_data = localStorage.getItem('text_data');
                    const content = result[text_data];
                    content_array = content.split(" ");
                    updateContent();
                } catch (error) {
                    console.error('Error:', error);
                }
            }

            function updateContent() {
                for (let i = contcrrwno; i < content_array.length; i++) {
                    if (contpnl.scrollHeight > 278) {
                        contcrrwno -= 1;
                        break;
                    }
                    contpnl.innerHTML += `<span id="c${i}">${content_array[i]}</span> `;
                    contcrrwno++;
                }
                init();
            }

            function init() {
                const currentWordElem = document.getElementById(`c${contcrrwno}`);
                if (currentWordElem) {
                    currentWordElem.style.color = "#3f10cb";
                    currentWordElem.style.textDecoration = "underline";
                }
                inptxtpnl.innerHTML += `<span id="inpw0">${lastword}</span>`;
            }

            function updateTimer() {
                if (timeLeft > 0) {
                    timeLeft--;
                    timeElapsed++;
                } else {
                    clearInterval(timer);
                    timer = null;
                    timerImg.src = "timeEnd.png";
                    gameOver();
                }
            }

            function gameOver() {
                clearInterval(timer);
                timer = null;
                timerImg.src = "timeEnd.png";
                inptxtpnl.removeEventListener("keydown", handleKeyPress);

                const errorHits = wrongWords * 5;
                const grossStrokes = inptxtpnl.innerText.length;
                const netStrokes = Math.max(0, grossStrokes - errorHits);
                const accuracy = Math.round((netStrokes / grossStrokes) * 100);
                const grossSpeed = Math.round(((grossStrokes / 5) / timeElapsed) * 60);
                const netSpeed = Math.round(((netStrokes / 5) / timeElapsed) * 60);

                if (totalWordsTyped < 5 || timeElapsed < 10) {
                    setTimeout(() => window.alert("You have typed for very short time - your performance scores cannot be calculated."), 10);
                } else if (timeElapsed > 10 && totalWordsTyped > 4) {
                    result = `Time Used: ${timeElapsed} sec\nGross Speed: ${grossSpeed}\nAccuracy: ${accuracy}%\nNet Speed: ${netSpeed}`;
                    setTimeout(() => {
                        console.log(result);
                        console.log(`Error Hits: ${errorHits}\nGross Strokes: ${grossStrokes}\nNet Strokes: ${netStrokes}`);
                    }, 10);
                } else {
                    window.alert('Text Not Entered!');
                }

                sessionStorage.setItem('"tU"', `${timeElapsed} sec`);
                gmOver = true;
            }

            function handleKeyPress(e) {
                allinptxt = inptxtpnl.innerText;
                allinptxtlen = allinptxt.length;

                if (alphabets.includes(e.key) && contcrrwno < content_array.length) {
                    if (totalWordsTyped === content_array.length) {
                        inptxtpnl.removeEventListener("keydown", handleKeyPress);
                        gameOver();
                    }

                    if (contcrrchno === 0) {
                        timer = setInterval(updateTimer, 1000);
                    }
                    contcrrchno++;
                    lastword += e.key;
                    totalStrokes++;
                    document.querySelector(`#inpw${contcrrwno}`).innerHTML = lastword;

                    if (totalStrokes === 1) {
                        timerImg.src = "timergif.gif";
                    }
                } else if (alphabets.includes(e.key) && contcrrwno === content_array.length) {
                    inptxtpnl.removeEventListener("keydown", handleKeyPress);
                    gameOver();
                }

                if (e.which === 8) {
                    if (backspaces === 0) {
                        e.preventDefault();
                    } else {
                        let delarr = lastword.split("");
                        delarr.pop();
                        lastword = delarr.join("");
                        document.querySelector(`#inpw${contcrrwno}`).innerHTML = lastword;
                        backspaces--;
                        contcrrchno--;
                    }
                }

                if (e.keyCode === 32 && lastword !== "" && contcrrwno < content_array.length) {
                    totalWordsTyped++;
                    if (totalWordsTyped === content_array.length) {
                        inptxtpnl.removeEventListener("keydown", handleKeyPress);
                        gameOver();
                    }
                    inpwarr.push(lastword);
                    if (lastword !== content_array[contcrrwno]) {
                        wrongWords++;
                    } else {
                        correctWords++;
                    }
                    lastword = "";
                    spaces++;
                    contcrrwno++;
                    document.querySelector(`#inpw${contcrrwno}`).innerHTML = lastword;
                }
            }

            fetchData().then(() => inptxtpnl.addEventListener("keydown", handleKeyPress));
        })();
    </script>
</body>
</html>
